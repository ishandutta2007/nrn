<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="881" height="578" version="1.1" viewBox="-0.5 -0.5 881 578"><g><rect width="48" height="24" x="0" y="16.8" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)scale(0.8)"><switch><foreignObject width="125%" height="125%" pointer-events="none" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow:visible;text-align:left"><div xmlns="http://www.w3.org/1999/xhtml" style="display:flex;align-items:unsafe center;justify-content:unsafe center;width:58px;height:1px;padding-top:36px;margin-left:1px"><div data-drawio-colors="color: rgb(0, 0, 0);" style="box-sizing:border-box;font-size:0;text-align:center"><div style="display:inline-block;font-size:12px;font-family:Helvetica;color:#000;line-height:1.2;pointer-events:all;white-space:normal;overflow-wrap:normal">Memory allocation of field_data (SoAoS)</div></div></div></foreignObject><text x="30" y="40" fill="#000" font-family="Helvetica" font-size="12" text-anchor="middle">Memory all...</text></switch></g><path fill="none" stroke="#000" stroke-miterlimit="10" stroke-width=".8" d="M 272 120.8 L 272 200.8 L 484 200.8 L 484 275.71" pointer-events="stroke"/><path fill="#000" stroke="#000" stroke-miterlimit="10" stroke-width=".8" d="M 484 279.91 L 481.2 274.31 L 484 275.71 L 486.8 274.31 Z" pointer-events="all"/><rect width="368" height="48" x="88" y="72.8" fill="#FFF" stroke="#000" stroke-width=".8" pointer-events="all"/><g transform="translate(-0.5 -0.5)scale(0.8)"><switch><foreignObject width="125%" height="125%" pointer-events="none" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow:visible;text-align:left"><div xmlns="http://www.w3.org/1999/xhtml" style="display:flex;align-items:unsafe center;justify-content:unsafe center;width:458px;height:1px;padding-top:121px;margin-left:111px"><div data-drawio-colors="color: rgb(0, 0, 0);" style="box-sizing:border-box;font-size:0;text-align:center"><div style="display:inline-block;font-size:12px;font-family:Helvetica;color:#000;line-height:1.2;pointer-events:all;white-space:normal;overflow-wrap:normal">Node has<a href="https://github.com/neuronsimulator/nrn/blob/a85f6ee0bfdde18e5004218f777fc626f6a2a740/src/nrnoc/section.h#L108" target="_blank">neuron::container::Node::owning_handle</a>member</div></div></div></foreignObject><text x="340" y="125" fill="#000" font-family="Helvetica" font-size="12" text-anchor="middle">Node has neuron::container::Node::owning_handle member</text></switch></g><path fill="none" stroke="#000" stroke-miterlimit="10" stroke-width=".8" d="M 484 360.8 L 484 475.71" pointer-events="stroke"/><path fill="#000" stroke="#000" stroke-miterlimit="10" stroke-width=".8" d="M 484 479.91 L 481.2 474.31 L 484 475.71 L 486.8 474.31 Z" pointer-events="all"/><rect width="792" height="80" x="88" y="280.8" fill="#FFF" stroke="#000" stroke-width=".8" pointer-events="all"/><g transform="translate(-0.5 -0.5)scale(0.8)"><switch><foreignObject width="125%" height="125%" pointer-events="none" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow:visible;text-align:left"><div xmlns="http://www.w3.org/1999/xhtml" style="display:flex;align-items:unsafe center;justify-content:unsafe center;width:988px;height:1px;padding-top:401px;margin-left:111px"><div data-drawio-colors="color: rgb(0, 0, 0);" style="box-sizing:border-box;font-size:0;text-align:center"><div style="display:inline-block;font-size:12px;font-family:Helvetica;color:#000;line-height:1.2;pointer-events:all;white-space:normal;overflow-wrap:normal"><a href="https://github.com/neuronsimulator/nrn/blob/a85f6ee0bfdde18e5004218f777fc626f6a2a740/src/neuron/container/soa_identifier.hpp#L80" target="_blank">Constructor of owning_handle</a>calls<a href="https://github.com/neuronsimulator/nrn/blob/a85f6ee0bfdde18e5004218f777fc626f6a2a740/src/neuron/container/soa_container.hpp#L902" target="_blank">acquire_owning_identifier</a>for both</div></div></div></foreignObject><text x="605" y="405" fill="#000" font-family="Helvetica" font-size="12" text-anchor="middle">Constructor of owning_handle calls acquire_owning_identifier for both</text></switch></g><path fill="none" stroke="#000" stroke-miterlimit="10" stroke-width=".8" d="M 710.35 120.66 L 710.27 200.8 L 484 200.8 L 484 275.71" pointer-events="stroke"/><path fill="#000" stroke="#000" stroke-miterlimit="10" stroke-width=".8" d="M 484 279.91 L 481.2 274.31 L 484 275.71 L 486.8 274.31 Z" pointer-events="all"/><rect width="368" height="48" x="512" y="72.8" fill="#FFF" stroke="#000" stroke-width=".8" pointer-events="all"/><g transform="translate(-0.5 -0.5)scale(0.8)"><switch><foreignObject width="125%" height="125%" pointer-events="none" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow:visible;text-align:left"><div xmlns="http://www.w3.org/1999/xhtml" style="display:flex;align-items:unsafe center;justify-content:unsafe center;width:458px;height:1px;padding-top:121px;margin-left:641px"><div data-drawio-colors="color: rgb(0, 0, 0);" style="box-sizing:border-box;font-size:0;text-align:center"><div style="display:inline-block;font-size:12px;font-family:Helvetica;color:#000;line-height:1.2;pointer-events:all;white-space:normal;overflow-wrap:normal">Prop has<a href="https://github.com/neuronsimulator/nrn/blob/a85f6ee0bfdde18e5004218f777fc626f6a2a740/src/nrnoc/section.h#L402" target="_blank">neuron::container::Mehcanism::owning_handle</a>member</div></div></div></foreignObject><text x="870" y="125" fill="#000" font-family="Helvetica" font-size="12" text-anchor="middle">Prop has neuron::container::Mehcanism::owning_handle member</text></switch></g><rect width="428" height="96" x="270" y="480.8" fill="#FFF" stroke="#000" stroke-width=".8" pointer-events="all"/><g transform="translate(-0.5 -0.5)scale(0.8)"><switch><foreignObject width="125%" height="125%" pointer-events="none" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow:visible;text-align:left"><div xmlns="http://www.w3.org/1999/xhtml" style="display:flex;align-items:unsafe center;justify-content:unsafe center;width:533px;height:1px;padding-top:661px;margin-left:338px"><div data-drawio-colors="color: rgb(0, 0, 0);" style="box-sizing:border-box;font-size:0;text-align:center"><div style="display:inline-block;font-size:12px;font-family:Helvetica;color:#000;line-height:1.2;pointer-events:all;white-space:normal;overflow-wrap:normal">By calling for_all_vectors&lt;detail::may_cause_reallocation::Yes&gt;() we append to the m_storage of field_data an element. We also set the m_ptr (std::unique_ptr&lt;std::size_t, deleter&gt;) of the owning_identifier to the old_size. This identifier will be used as offset to access the corresponding element from other parts of the code. Due to the fact that we use the detail::may_cause_reallocation::Yes template, when we call for_all_vectors() the m_data_ptrs member of the field_data for mechanisms will be updated to use the up to date pointers to the m_storage vectors</div></div></div></foreignObject><text x="605" y="665" fill="#000" font-family="Helvetica" font-size="12" text-anchor="middle">By calling for_all_vectors&lt;detail::may_cause_reallocation::Yes&gt;() we append to the m_stor...</text></switch></g></g><switch><a target="_blank" transform="translate(0,-5)" xlink:href="https://www.drawio.com/doc/faq/svg-export-text-problems"><text x="50%" y="100%" font-size="10" text-anchor="middle">Text is not SVG - cannot display</text></a></switch></svg>